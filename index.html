<!DOCTYPE html>
<html lang="it" class=""> <!-- La classe per il tema verr√† aggiunta qui da JS -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patologo Virtuale</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }
        /* Stili definiti tramite variabili CSS per un facile cambio di tema */
        :root {
            --bg-color: #111827; /* bg-gray-900 */
            --text-color: #e5e7eb; /* text-gray-200 */
            --header-text-color: #ffffff;
            --subheader-text-color: #9ca3af; /* text-gray-400 */
            --card-bg-color: #1f2937; /* bg-gray-800 */
            --card-border-color: #4b5563; /* border-gray-600 */
            --input-bg-color: #374151; /* bg-gray-700 */
            --input-border-color: #4b5563; /* border-gray-600 */
            --primary-color: #4f46e5; /* indigo-600 */
            --logo-color: #e5e7eb; /* text-gray-200 */
            --correct-bg: rgba(16, 185, 129, 0.2);
            --correct-border: #10b981;
            --correct-text: #6ee7b7;
            --incorrect-bg: rgba(239, 68, 68, 0.2);
            --incorrect-border: #ef4444;
            --incorrect-text: #fca5a5;
        }

        html.light {
            --bg-color: #f9fafb; /* bg-gray-50 */
            --text-color: #1f2937; /* text-gray-800 */
            --header-text-color: #000000;
            --subheader-text-color: #4b5563; /* text-gray-600 */
            --card-bg-color: #ffffff;
            --card-border-color: #d1d5db; /* border-gray-300 */
            --input-bg-color: #f3f4f6; /* bg-gray-100 */
            --input-border-color: #d1d5db; /* border-gray-300 */
            --logo-color: #1f2937; /* text-gray-800 */
            --correct-bg: #dcfce7;
            --correct-border: #4ade80;
            --correct-text: #15803d;
            --incorrect-bg: #fee2e2;
            --incorrect-border: #f87171;
            --incorrect-text: #b91c1c;
        }

        /* Applicazione delle variabili di tema */
        body { background-color: var(--bg-color); color: var(--text-color); }
        h1, h2, h3 { color: var(--header-text-color); }
        .subheader { color: var(--subheader-text-color); }
        .card { background-color: var(--card-bg-color); }
        .card-border { border-color: var(--card-border-color); }
        .input-bg { background-color: var(--input-bg-color); }
        .input-border { border-color: var(--input-border-color); }
        .logo-path { fill: var(--logo-color); transition: fill 0.3s; }

        .topic-label {
            background-color: var(--input-bg-color);
            border-color: var(--input-border-color);
            color: var(--text-color);
        }
        .topic-checkbox:checked + .topic-label {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        .option-radio:checked + label {
            background-color: #374151;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px var(--primary-color);
        }
        html.light .option-radio:checked + label {
            background-color: #e5e7eb;
        }
        
        /* Stili per il report */
        .report-card.correct { border-color: var(--correct-border); }
        .report-card.correct .report-header { background-color: var(--correct-bg); }
        .report-card.correct .status-text { color: var(--correct-text); }
        .report-card.incorrect { border-color: var(--incorrect-border); }
        .report-card.incorrect .report-header { background-color: var(--incorrect-bg); }
        .report-card.incorrect .status-text { color: var(--incorrect-text); }
        .report-card.unanswered .status-text { color: var(--subheader-text-color); }
    </style>
</head>
<body>

    <!-- Sezione Login -->
    <div id="login-section" class="min-h-screen flex items-center justify-center p-4">
        <div class="card p-8 rounded-lg shadow-lg w-full max-w-sm">
            <h2 class="text-2xl font-bold text-center mb-6">Login</h2>
            <form id="login-form">
                <div class="mb-4">
                    <label for="username" class="block text-sm font-medium mb-2">Username</label>
                    <input type="text" id="username" name="username" class="w-full p-2 rounded input-bg input-border focus:ring-2 focus:ring-indigo-500 focus:outline-none" required>
                </div>
                <div class="mb-6">
                    <label for="password" class="block text-sm font-medium mb-2">Password</label>
                    <input type="password" id="password" name="password" class="w-full p-2 rounded input-bg input-border focus:ring-2 focus:ring-indigo-500 focus:outline-none" required>
                </div>
                <button type="submit" class="w-full bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-indigo-700 transition duration-300">
                    Accedi
                </button>
                <p id="login-error" class="text-red-400 text-center text-sm mt-4 hidden">Credenziali non valide.</p>
            </form>
        </div>
    </div>

    <!-- Contenitore App Principale (nascosto di default) -->
    <div id="app-container" class="hidden">
        <div class="container mx-auto p-4 md:p-8 max-w-4xl">
            <header class="text-center mb-8 relative">
                <h1 class="text-4xl font-bold mb-2">Patologo Virtuale</h1>
                <p class="text-lg subheader">Mettiti alla prova con domande generate dai tuoi appunti di anatomia patologica.</p>
                
                <div class="absolute top-0 right-0 flex items-center space-x-2">
                    <span class="text-sm subheader">Tema:</span>
                    <button id="theme-light" title="Tema Chiaro" class="p-2 rounded-full hover:bg-gray-700 dark:hover:bg-gray-600 transition">‚òÄÔ∏è</button>
                    <button id="theme-dark" title="Tema Scuro" class="p-2 rounded-full hover:bg-gray-700 dark:hover:bg-gray-600 transition">üåô</button>
                    <button id="theme-system" title="Tema di Sistema" class="p-2 rounded-full hover:bg-gray-700 dark:hover:bg-gray-600 transition">üíª</button>
                </div>
            </header>

            <div id="setup-section" class="card p-6 rounded-lg shadow-lg mb-8">
                <div id="progress-container" class="mb-6">
                    <h3 class="text-lg font-medium mb-2">Argomenti Identificati</h3>
                    <div class="w-full bg-gray-700 rounded-full h-2.5">
                        <div id="progress-bar" class="bg-indigo-600 h-2.5 rounded-full" style="width: 100%;"></div>
                    </div>
                    <p id="progress-text" class="text-sm subheader mt-1">Analisi dei file completata.</p>
                </div>

                <div id="topic-selection">
                    <h3 class="text-lg font-medium mb-3">Scegli gli argomenti per il quiz:</h3>
                    <div class="flex items-center mb-4">
                        <input type="checkbox" id="select-all-topics" class="h-4 w-4 rounded input-border input-bg text-indigo-600 focus:ring-indigo-500">
                        <label for="select-all-topics" class="ml-2 block text-sm">Seleziona tutti / Deseleziona tutti</label>
                    </div>
                    <div id="topics-list" class="flex flex-wrap gap-2"></div>
                </div>
                
                <button id="start-quiz-btn" class="mt-6 w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-indigo-700 transition duration-300 disabled:bg-gray-600">
                    Avvia il Quiz (45 Domande)
                </button>
            </div>

            <div id="quiz-section" class="hidden card p-6 rounded-lg shadow-lg">
                <div class="mb-4">
                    <div class="flex justify-between items-center mb-2">
                        <span id="question-counter" class="text-sm font-medium subheader">Domanda 1 di 45</span>
                        <button id="finish-quiz-btn" class="bg-red-600 text-white font-bold py-1 px-3 text-sm rounded-lg hover:bg-red-700 transition duration-300">Termina Quiz</button>
                    </div>
                    <div class="w-full bg-gray-700 rounded-full h-2.5">
                        <div id="quiz-progress-bar" class="bg-indigo-600 h-2.5 rounded-full transition-all duration-500" style="width: 0%"></div>
                    </div>
                </div>
                <div id="quiz-content" class="mb-6"></div>
                <div class="flex justify-between">
                    <button id="prev-btn" class="bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-700 transition">Precedente</button>
                    <button id="next-btn" class="bg-indigo-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-indigo-700 transition">Successivo</button>
                </div>
            </div>

            <div id="report-section" class="hidden card p-6 rounded-lg shadow-lg">
                <h2 class="text-3xl font-bold text-center mb-4">Report del Quiz</h2>
                <div class="text-center mb-6 p-4 input-bg rounded-lg">
                    <p class="text-lg">Punteggio Finale:</p>
                    <p id="final-score" class="text-5xl font-extrabold text-indigo-400"></p>
                    <p class="text-md subheader">normalizzato in 33esimi</p>
                </div>
                <div id="report-content" class="space-y-4"></div>
                <button id="restart-btn" class="mt-8 w-full bg-gray-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-gray-700 transition">
                    Ricomincia
                </button>
            </div>
        </div>
        
        <footer class="text-center py-8 subheader">
            <div class="flex items-center justify-center space-x-2">
                <span>Made with <span class="text-red-500">&lt;3</span> by</span>
                <!-- SVG Logo rimpicciolito -->
                <svg class="h-5" viewBox="0 0 304.55 55.49">
                    <g class="logo-path">
                         <path d="M.96,1.04h-.96v2.37h.96c1.47,0,1.82,0,1.82,1.98v44.81c0,1.98-.46,1.98-1.82,1.98h-.96v2.29h9.88v-2.29h-.96c-1.36,0-1.82,0-1.82-1.98V5.38c0-1.98.35-1.98,1.82-1.98h.96V1.04H.96Z"/>
                        <path d="M50.95,41.8h-.96v.96c0,8.26-.53,8.75-4.72,8.75h-9.43V5.38c0-1.98.35-1.98,1.82-1.98h.96V1.04h-9.88v2.37h.96c1.47,0,1.82,0,1.82,1.98v44.81c0,1.98-.46,1.98-1.82,1.98h-.96v2.29h23.45v-12.67h-1.25Z"/>
                        <path d="M83.32,47.68h-.96v.96c0,2.4-1.07,3.89-2.79,3.89-1.62,0-2.44-3.22-2.44-9.56V1.04h-7.09v2.29h.96c1.36,0,1.82,0,1.82,1.98v28.69c0,12.04-4.36,18.53-8.47,18.53-4.85,0-5.23-6.98-5.23-9.12V1.04h-7.09v2.29h.96c1.36,0,1.82,0,1.82,1.98v37.08c0,7.59,4.01,13.1,9.54,13.1,3.7,0,6.82-2.22,9.14-6.48,1.19,5.26,3.75,6.48,5.86,6.48,3.9,0,5.68-3.55,5.68-6.85v-.96h-1.7Z"/>
                        <path d="M115.7,1.04h-.66l-.24.61-11.59,29.7L93.1,1.69l-.22-.65h-7.39v2.29h.96c1.36,0,1.82,0,1.82,1.98v44.88c0,1.98-.46,1.98-1.82,1.98h-.96v2.29h8.29v-2.29h-.96c-1.36,0-1.82,0-1.82-1.98V9.22s.02.05.03.08c1.71,4.99,4.55,13.32,9.4,27.63l-3.17,8.28c-1.05,2.55-.78,5.84.66,7.98.99,1.48,2.49,2.3,4.22,2.3,1.88,0,3.46-.82,4.58-2.38,1.55-2.16,1.98-5.58,1.05-8.31l-3.18-9.38,10.62-27.14v41.91c0,1.98-.39,1.98-1.82,1.98h-.96v2.29h9.88v-2.29h-.96c-1.36,0-1.82,0-1.82-1.98V5.31c0-1.98.46-1.98,1.82-1.98h.96V1.04h-6.59ZM103.72,51.35c-.58.9-1.45,1.17-1.61,1.19-.73,0-1.3-.31-1.73-.93-1.05-1.51-.98-4.35-.47-5.71l1.92-4.87c.59,1.77,1.24,3.68,1.95,5.67.67,1.96.65,3.57-.05,4.66Z"/>
                        <path d="M130.01,7.75c.27,0,.54-.04.8-.12,1.66-.51,2.68-2.54,2.31-4.62-.33-1.78-1.6-3.01-3.1-3.01h0c-.27,0-.54.04-.8.12-1.72.51-2.74,2.49-2.37,4.62.32,1.75,1.65,3.01,3.16,3.01Z"/>
                        <path d="M132.17,50.19V13.62c0-2.27-1.47-4.05-3.35-4.05h-3.75v2.29h.96c1.47,0,1.82,0,1.82,1.98v36.35c0,1.98-.46,1.98-1.82,1.98h-.96v2.29h9.88v-2.29h-.96c-1.36,0-1.82,0-1.82-1.98Z"/>
                        <path d="M167.39,1.04h-7.32v2.29h.96c1.36,0,1.82,0,1.82,1.98v36.94L144.53,1.6l-.26-.57h-6.53v2.29h.96c1.36,0,1.82,0,1.82,1.98v44.88c0,1.98-.46,1.98-1.82,1.98h-.96v2.29h8.29v-2.29h-.96c-1.36,0-1.82,0-1.82-1.98V9.5l20.47,45.41h1.85V5.31c0-1.98.39-1.98,1.82-1.98h.96V1.04h-.96Z"/>
                        <path d="M205.62,47.68h-.96v.96c0,2.87-1.41,3.89-2.73,3.89-1.66,0-2.5-3.22-2.5-9.56V15.68C199.42,8.45,195.91,0,186.02,0c-4.81,0-11.28,2.6-13.69,9.93l-.28.85.83.34,2.5,1.03,1.01.42.29-1.05c1.72-6.32,6.2-8.56,9.52-8.56,7.86,0,8.92,7.06,8.92,13.97v2.95c-9.7.18-24.82,3.27-24.82,20.67,0,8.8,5.07,14.94,12.32,14.94,5.54,0,9.81-3.14,12.72-9.34.66,6.2,2.79,9.34,6.37,9.34,4.12,0,5.62-4.1,5.62-6.85v-.96h-1.7ZM182.61,52.54c-5.09,0-8.01-4.37-8.01-11.99,0-15.83,14.62-17.89,20.51-18.08v4.61c0,5.97-.9,25.45-12.5,25.45Z"/>
                        <path d="M234.87,49.28l-12.8-19.41c.2.01.4.02.59.02,5.99,0,12.04-4.92,12.04-15.9,0-8.23-4.91-12.96-13.46-12.96h-12.55v2.29h.96c1.36,0,1.82,0,1.82,1.98v44.88c0,1.98-.46,1.98-1.82,1.98h-.96v2.29h9.88v-2.29h-.96c-1.36,0-1.82,0-1.82-1.98v-21.49l14.76,22.24c1.47,2.24,3.67,3.52,6.03,3.52h2.78v-2.29h-.96c-1.25,0-1.72-.27-3.52-2.89ZM221.58,26.49c-1.74,0-3.55-.61-5.37-1.83l-.42-.28V5.31c0-.84,2.07-1.32,5.68-1.32,3.17,0,8.52,2.14,8.52,10.15,0,7.16-3.54,12.35-8.41,12.35Z"/>
                        <path d="M246.22,7.75c.27,0,.54-.04.8-.12,1.66-.51,2.68-2.54,2.31-4.62-.33-1.78-1.6-3.01-3.1-3.01h0c-.27,0-.54.04-.8.12-1.72.51-2.74,2.49-2.37,4.62.32,1.75,1.65,3.01,3.16,3.01Z"/>
                        <path d="M250.21,52.17c-1.36,0-1.82,0-1.82-1.98V13.62c0-2.27-1.47-4.05-3.35-4.05h-3.75v2.29h.96c1.47,0,1.82,0,1.82,1.98v36.35c0,1.98-.46,1.98-1.82,1.98h-.96v2.29h9.88v-2.29h-.96Z"/>
                        <path d="M272.67,15.88c2.22-1.52,3.69-4.12,3.69-7.08,0-4.97-4.03-8.31-10.04-8.31-4.38,0-7.91,1.94-9.2,5.06-1.13,2.73-.32,5.84,2.16,8.32l.57.57,2.39-.9-.62-1.24c-1.17-2.32-1.26-4.51-.24-6.15.99-1.6,2.94-2.56,5.21-2.56,3.64,0,5.48,1.73,5.48,5.14,0,5.49-5.51,5.91-7.2,5.91h-1.24v3.13h1.24c4.09,0,8.45.51,8.45,6.6,0,4.77-3.38,6.9-6.73,6.9-2.27,0-4.22-.96-5.21-2.56-1.01-1.64-.93-3.83.24-6.15l.62-1.24-2.39-.9-.57.57c-2.48,2.48-3.29,5.59-2.16,8.32,1.29,3.12,4.82,5.06,9.2,5.06,4.69,0,11.29-3.1,11.29-9.99,0-4.67-2.36-7.22-4.94-8.48Z"/>
                        <path d="M287.53,1.09h-10.04v2.75h1.24c.48,0,.72.02.83.05.02.07.04.2.04.43v26.25c0,.23-.02.36-.04.42-.1.03-.32.06-.83.06h-1.24v2.7h10.04c12.55,0,17.02-8.41,17.02-16.29s-4.47-16.37-17.02-16.37ZM287.71,30.66c-2.55,0-3.47-.21-3.8-.35V4.56c.31-.13,1.22-.38,3.8-.38,5.65,0,12.25,3.48,12.25,13.28s-6.33,13.2-12.25,13.2Z"/>
                        <path d="M264.3,41.89h-1.52v-1.52c0-.69-.56-1.25-1.25-1.25s-1.25.56-1.25,1.25v1.52h-1.52c-.69,0-1.25.56-1.25,1.25s.56,1.25,1.25,1.25h1.52v1.52c0,.69.56,1.25,1.25,1.25s1.25-.56,1.25-1.25v-1.52h1.52c.69,0,1.25-.56,1.25-1.25s-.56-1.25-1.25-1.25Z"/>
                        <path d="M290.3,41.89h-1.52v-1.52c0-.69-.56-1.25-1.25-1.25s-1.25.56-1.25,1.25v1.52h-1.52c-.69,0-1.25.56-1.25,1.25s.56,1.25,1.25,1.25h1.52v1.52c0,.69.56,1.25,1.25,1.25s1.25-.56,1.25-1.25v-1.52h1.52c.69,0,1.25-.56,1.25-1.25s-.56-1.25-1.25-1.25Z"/>
                        <path d="M277.3,50.17h-1.52v-1.52c0-.69-.56-1.25-1.25-1.25s-1.25.56-1.25,1.25v1.52h-1.52c-.69,0-1.25.56-1.25,1.25s.56,1.25,1.25,1.25h1.52v1.52c0,.69.56,1.25,1.25,1.25s1.25-.56,1.25-1.25v-1.52h1.52c.69,0,1.25-.56,1.25-1.25s-.56-1.25-1.25-1.25Z"/>
                        <path d="M303.3,50.17h-1.52v-1.52c0-.69-.56-1.25-1.25-1.25s-1.25.56-1.25,1.25v1.52h-1.52c-.69,0-1.25.56-1.25,1.25s.56,1.25,1.25,1.25h1.52v1.52c0,.69.56,1.25,1.25,1.25s1.25-.56,1.25-1.25v-1.52h1.52c.69,0,1.25-.56,1.25-1.25s-.56-1.25-1.25-1.25Z"/>
                    </g>
                </svg>
                <span>and Beatrice Gigliola</span>
            </div>
        </footer>
    </div>
    <!-- Script principale dell'applicazione -->
    <script>
        // --- BANCA DATI DELLE DOMANDE ---
        // (La banca dati √® stata omessa per brevit√†, √® identica alla versione precedente)
        const questionBank = [
            { topic: "Metodologia", question: "Quale di questi parametri non √® valutabile macroscopicamente?", options: ["Forma", "Dimensioni", "Numero di mitosi", "Consistenza", "Colore"], correctAnswer: 2, explanation: "Il numero di mitosi √® un parametro istologico, visibile solo al microscopio, e non pu√≤ essere valutato macroscopicamente.", isFromFile: true },
            { topic: "Metodologia", question: "La colorazione pi√π comunemente usata per l'osservazione istologica morfologica √® l'ematossilina-eosina. Essa si basa:", options: ["Su principi fisici di densit√†", "Su affinit√† di tipo acido-base", "Su affinit√† antigene-anticorpo", "Su legami chimici covalenti", "Su principi non noti"], correctAnswer: 1, explanation: "L'ematossilina √® un colorante basico che lega le strutture acide (basofile) come i nuclei (DNA/RNA), colorandole in blu/viola. L'eosina √® un colorante acido che lega le strutture basiche (acidofile) come il citoplasma, colorandolo in rosa/rosso.", isFromFile: true },
            { topic: "Danno Cellulare", question: "Per apoptosi si intende?", options: ["La morte cellulare non programmata", "La morte cellulare programmata", "Le modificazioni conseguenti alla morte cellulare non programmata", "L'ischemia", "La morte cellulare in genere"], correctAnswer: 1, explanation: "L'apoptosi √® un meccanismo di morte cellulare geneticamente programmato, essenziale per l'omeostasi dei tessuti, che non scatena una risposta infiammatoria.", isFromFile: true },
            { topic: "Danno Cellulare", question: "In caso di patogenesi ischemica il quadro morfologico sar√† generalmente caratterizzato da:", options: ["Necrosi coagulativa", "Necrosi colliquativa", "Necrosi fibrinoide", "Necrosi caseosa", "Apoptosi"], correctAnswer: 0, explanation: "L'ischemia causa una denaturazione delle proteine strutturali ed enzimatiche, ma l'architettura tissutale viene preservata per alcuni giorni. Questo tipo di necrosi √® definito coagulativa.", isFromFile: true },
            { topic: "Adattamenti Cellulari", question: "L'aumento del numero delle cellule in un organo o in un tessuto si definisce:", options: ["Iperplasia", "Ipertrofia", "Displasia", "Metaplasia", "Neoplasia"], correctAnswer: 0, explanation: "L'iperplasia √® un aumento del numero di cellule in un tessuto, che porta a un aumento del volume dell'organo. √à diversa dall'ipertrofia, che √® un aumento del volume delle singole cellule.", isFromFile: true },
            { topic: "Neoplasie", question: "Il 'grading', o graduazione, di una neoplasia?", options: ["Esprime il grado di differenziazione di una neoplasia maligna", "Definisce la benignit√† o la malignit√†", "Definisce l'estensione di una neoplasia", "Esprime la localizzazione", "√à un parametro trascurabile"], correctAnswer: 0, explanation: "Il grading istologico valuta il grado di somiglianza delle cellule tumorali con il tessuto di origine (differenziazione). Un tumore ben differenziato (basso grado) assomiglia molto al tessuto normale, mentre uno scarsamente differenziato (alto grado) se ne discosta notevolmente.", isFromFile: true },
            { topic: "Neoplasie", question: "Nell'ambito del sistema di stadiazione TNM il parametro M esprime:", options: ["L'estensione del tumore rispetto l'organismo in toto", "Il coinvolgimento dei linfonodi loco-regionali", "La presenza di metastasi a distanza", "Il coinvolgimento di linfonodi a distanza", "L'estensione del tumore rispetto l'organo di origine"], correctAnswer: 2, explanation: "Il sistema TNM √® il sistema di stadiazione pi√π usato. T descrive il tumore primitivo, N lo stato dei linfonodi regionali, e M la presenza (M1) o assenza (M0) di metastasi a distanza.", isFromFile: true },
            { topic: "Cardiocircolatorio", question: "Un paziente ha un dolore anginoso per trombosi di una coronaria epicardica. Viene effettuata trombolisi entro 25 minuti dall‚Äôinsorgenza del dolore. Quale conseguenza si pu√≤ attendere per l'area miocardica ischemica?", options: ["Rottura di cuore ed emopericardio", "Salvataggio del miocardio che per√≤ rimane stordito", "Sviluppo di infarto ischemico, che rimane limitato al terzo subendocardico", "Sviluppo di infarto ischemico transmurale", "Sviluppo di infarto emorragico da rivascolarizzazione"], correctAnswer: 1, explanation: "Una riperfusione molto precoce (entro 20-40 minuti) pu√≤ salvare il miocardio dalla necrosi. Tuttavia, il tessuto salvato pu√≤ rimanere 'stordito', con una disfunzione contrattile transitoria che si risolve in ore o giorni.", isFromFile: true },
            { topic: "Cardiocircolatorio", question: "Quale delle seguenti condizioni NON √® una possibile complicanza dell'infarto del miocardio?", options: ["Rottura del cuore e tamponamento cardiaco", "Perforazione del setto interventricolare", "Trombosi endocardiaca", "Pericardite di Dressler", "Insufficienza acuta della valvola aortica"], correctAnswer: 4, explanation: "L'insufficienza aortica acuta non √® una complicanza diretta dell'IMA. Le complicanze meccaniche includono la rottura di parete, setto o muscolo papillare (che causa insufficienza mitralica, non aortica).", isFromFile: true },
            { topic: "Polmone-Respiratorio", question: "Quale tra le seguenti NON √® una pneumoconiosi:", options: ["Asbestosi", "Silicosi", "Aspergillosi", "Antracosi", "Berilliosi"], correctAnswer: 2, explanation: "Le pneumoconiosi sono malattie polmonari causate dall'inalazione di polveri inorganiche. L'aspergillosi √® invece un'infezione causata da un fungo del genere Aspergillus.", isFromFile: true },
            { topic: "Polmone-Respiratorio", question: "Il mesotelioma:", options: ["√à un tumore primitivo periferico del polmone", "Riconosce l‚Äôesposizione dell‚Äôasbesto come fattore di rischio", "√à sinonimo di carcinomatosi pleurica", "Colpisce esclusivamente la sierosa pleurica", "Nessuna delle risposte indicate"], correctAnswer: 1, explanation: "Il mesotelioma √® un tumore maligno che origina dalle cellule mesoteliali delle sierose (pleura, peritoneo, pericardio). La sua associazione con l'esposizione a fibre di asbesto √® molto forte e ben documentata.", isFromFile: true },
            { topic: "Osso", question: "La complicanza pi√π grave dell‚Äôosteoporosi √®:", options: ["Il gibbo acuto", "La sostituzione adiposa del midollo", "I dolori diffusi", "Il gibbo armonico", "La frattura del collo del femore nell‚Äôanziano"], correctAnswer: 4, explanation: "L'osteoporosi √® una riduzione della massa ossea che aumenta la fragilit√† dello scheletro. La sua complicanza pi√π grave e comune, specialmente nella popolazione anziana, √® la frattura patologica, tipicamente a carico del collo del femore, delle vertebre o del polso.", isFromFile: true },
            { topic: "Mammella", question: "Il carcinoma lobulare infiltrante della mammella:", options: ["Insorge nei lobuli", "Non √® mai multicentrico", "Metastatizza tardivamente", "Ha una buona prognosi", "Infiltra a ‚Äúfila indiana‚Äù"], correctAnswer: 4, explanation: "A causa della perdita di espressione della E-caderina, le cellule del carcinoma lobulare infiltrante perdono coesione e tipicamente infiltrano lo stroma in singole file, un pattern detto 'a fila indiana'.", isFromFile: true },
            { topic: "Rene, Vie Urinarie e Vescica", question: "Caratteristica costante della sindrome nefrosica √®?", options: ["Oliguria", "Poliuria", "Ematuria", "Proteinuria", "Glicosuria"], correctAnswer: 3, explanation: "La sindrome nefrosica √® definita da una proteinuria massiva (>3.5 g/24h), che causa ipoalbuminemia, edema e iperlipidemia. La proteinuria √® il segno cardinale.", isFromFile: true },
            { topic: "Testicolo", question: "Un tumore testicolare a differenziazione cito e sinciziotrofoblastica viene definito:", options: ["Seminoma", "Teratoma", "Carcinoma embrionale", "Coriocarcinoma", "Tumore del sacco vitellino"], correctAnswer: 3, explanation: "Il coriocarcinoma √® composto da elementi che mimano il trofoblasto placentare: il citotrofoblasto (cellule mononucleate) e il sinciziotrofoblasto (cellule multinucleate giganti), queste ultime responsabili della produzione di Œ≤-hCG.", isFromFile: true },
            { topic: "Prostata", question: "Nell‚Äôadenocarcinoma della prostata:", options: ["Le ghiandole sono circondate da cellule basali", "Le cellule neoplastiche presentano nucleolo evidente", "√à sempre presente necrosi comedonica", "Le cellule sono sempre chiare", "Non si usa il grading di Gleason"], correctAnswer: 1, explanation: "Una delle caratteristiche istologiche chiave per la diagnosi di adenocarcinoma prostatico √® la presenza di nucleoli prominenti, specialmente nei gradi pi√π alti. L'assenza dello strato di cellule basali √® un altro criterio fondamentale.", isFromFile: true },
            { topic: "Ovaio e Utero", question: "Una donna di 55 anni presenta distensione addominale progressiva negli ultimi 5 mesi. Un'ecografia pelvica mostra masse cistiche ovariche bilaterali di 7 e 10 cm con proiezioni papillari. L‚Äôesame istologico mostra che le papille sono ricoperte da cellule cuboidi atipiche che invadono lo stroma sottostante, sono presenti alcuni corpi psammomatosi. Qual √® la diagnosi pi√π probabile?", options: ["Tumore a cellule della granulosa", "Teratoma maturo cistico", "Tumore endometrioide", "Disgerminoma", "Cistoadenocarcinoma sieroso"], correctAnswer: 4, explanation: "La descrizione (bilaterale, cistico con proiezioni papillari, invasione stromale e corpi psammomatosi) √® classica per un cistoadenocarcinoma sieroso di alto grado, il tumore maligno pi√π comune dell'ovaio.", isFromFile: true },
            { topic: "Metodologia", question: "Quale dei seguenti parametri non √® apprezzabile su un esame istologico in microscopia ottica?", options: ["Caratteristiche nucleari", "Architettura del tessuto", "Caratteristiche citoplasmatiche", "Inclusi nucleari e citoplasmatici", "Densit√† dei mitocondri"], correctAnswer: 4, explanation: "La densit√† e la morfologia fine degli organelli come i mitocondri richiedono l'ultrisoluzione del microscopio elettronico e non sono apprezzabili con la microscopia ottica standard.", isFromFile: true },
            { topic: "Danno Cellulare", question: "Cosa distingue istologicamente la necrosi coagulativa dalla necrosi colliquativa:", options: ["L'eosinofilia del citoplasma", "La picnosi del nucleo", "La possibilit√† o meno di conoscere la forma delle cellule necrotiche", "La diversa colorabilit√† con il metodo PAS", "Presenza / assenza di infiltrato infiammatorio"], correctAnswer: 2, explanation: "Nella necrosi coagulativa, la forma delle cellule morte viene mantenuta per un certo tempo. Nella necrosi colliquativa, la digestione enzimatica del tessuto √® rapida e completa, portando alla perdita dell'architettura e alla formazione di una massa liquida viscosa.", isFromFile: true },
            { topic: "Adattamenti Cellulari", question: "Per metaplasia si intende:", options: ["La trasformazione di un tessuto in un altro", "La trasformazione di un tessuto ben differenziato in un altro ben differenziato", "La trasformazione di un tessuto ben differenziato in un altro ben differenziato della stessa derivazione istologica", "Un evento preneoplastico", "Una neoplasia in situ"], correctAnswer: 2, explanation: "La metaplasia √® la sostituzione reversibile di un tipo cellulare adulto (epiteliale o mesenchimale) con un altro tipo cellulare adulto, solitamente come adattamento a uno stress cronico. La derivazione embriologica deve essere la stessa.", isFromFile: true },
            { topic: "Neoplasie", question: "Lo 'staging', stadiazione, di una neoplasia:", options: ["Esprime il grado di differenziazione", "Definisce la benignit√† o la malignit√†", "Definisce l'estensione di una neoplasia maligna rispetto l'organismo", "Esprime la localizzazione superficiale o profonda", "√à un parametro trascurabile"], correctAnswer: 2, explanation: "Lo staging descrive l'estensione anatomica del tumore (dimensioni, invasione locale, coinvolgimento linfonodale, metastasi a distanza). √à il fattore prognostico pi√π importante per la maggior parte dei tumori.", isFromFile: true },
            { topic: "Cardiocircolatorio", question: "Quale, tra i seguenti, non √® un fattore di rischio per l‚Äôaterosclerosi:", options: ["Alti livelli ematici di HDL", "Diabete", "Ipertensione arteriosa", "Fumo di sigaretta", "Carenza di esercizio fisico"], correctAnswer: 0, explanation: "Le lipoproteine ad alta densit√† (HDL) hanno un ruolo protettivo contro l'aterosclerosi, promuovendo il trasporto inverso del colesterolo dai tessuti periferici al fegato. Alti livelli di HDL sono quindi desiderabili.", isFromFile: true },
            { topic: "Polmone-Respiratorio", question: "Quale/i istotipi di carcinoma del polmone sono pi√π frequentemente periferici?", options: ["Carcinoma epidermoide e Microcitoma", "Adenocarcinoma e Adenocarcinoma bronchioloalveolare", "Solo Microcitoma", "Tutti tranne l'Adenocarcinoma", "Solo Adenolinfoma"], correctAnswer: 1, explanation: "Mentre i carcinomi squamosi e a piccole cellule tendono a essere centrali (ilari), l'adenocarcinoma (l'istotipo oggi pi√π frequente) insorge tipicamente in sede periferica.", isFromFile: true },
            { topic: "Osso", question: "La condizione neoplastica maligna pi√π frequente dell'osso:", options: ["Il condrosarcoma", "L‚Äôosteosarcoma", "La malattia metastatica", "Il mieloma multiplo", "Il sarcoma di Ewing"], correctAnswer: 2, explanation: "Le metastasi da altri tumori (es. mammella, prostata, polmone, rene) sono le neoplasie maligne pi√π comuni che si riscontrano nello scheletro, superando di gran lunga i tumori ossei primitivi.", isFromFile: true },
            { topic: "Mammella", question: "Quale dei seguenti istotipi di carcinoma infiltrante della mammella ha la prognosi migliore:", options: ["Carcinoma duttale tipo NAS", "Carcinoma lobulare", "Carcinoma midollare con stroma linfoide", "Carcinoma mucinoso", "Carcinoma neuroendocrino"], correctAnswer: 2, explanation: "Il carcinoma midollare, sebbene spesso triplo negativo, √® caratterizzato da un cospicuo infiltrato linfocitario e ha una prognosi relativamente favorevole rispetto ad altri carcinomi di alto grado. Anche il mucinoso e il tubulare (non in lista) hanno buona prognosi.", isFromFile: true },
            { topic: "Rene, Vie Urinarie e Vescica", question: "La glomerulonefrite rapidamente progressiva √® caratterizzata istologicamente da:", options: ["Proliferazione delle cellule endoteliali", "Proliferazione delle cellule mesangiali", "Formazione di semilune nello spazio di filtrazione renale", "Ialinizzazioni focali delle anse glomerulari", "Formazioni di anse a fil di ferro"], correctAnswer: 2, explanation: "La caratteristica istologica distintiva della GNRP √® la formazione di 'semilune' (crescents) nello spazio di Bowman, dovute alla proliferazione delle cellule epiteliali parietali e all'infiltrazione di monociti/macrofagi.", isFromFile: true },
            { topic: "Testicolo", question: "Quale tra le seguenti affermazioni sul seminoma √®/sono esatta/e? I. √à una neoplasia neuroendocrina II. Metastatizza ai linfonodi paraortici III. √à il pi√π maligno dei tumori del testicolo IV. √à spesso caratterizzato da infiltrato linfocitario V. Presenta un aspetto adenoideo", options: ["IV, V", "V", "II, IV", "IV", "I, II, III"], correctAnswer: 2, explanation: "Il seminoma metastatizza tipicamente per via linfatica ai linfonodi paraortici (drenaggio primario del testicolo) e istologicamente presenta spesso un caratteristico infiltrato linfocitario stromale. Non √® neuroendocrino e non √® il pi√π maligno (il coriocarcinoma lo √®).", isFromFile: true },
            { topic: "Prostata", question: "Il Grade Group dell‚Äôadenocarcinoma prostatico viene attribuito:", options: ["Sui valori di PSA", "Sommando pattern primario, secondario e terziario", "Sul pattern prevalente di Gleason", "Sul grado combinato di Gleason", "Nessuna delle risposte indicate"], correctAnswer: 3, explanation: "Il sistema Grade Group (da 1 a 5) √® una semplificazione prognostica del Gleason Score. Si basa sulla somma dei due pattern di Gleason pi√π rappresentati nel tumore (es. Gleason 3+4 = 7, che corrisponde al Grade Group 2).", isFromFile: true },
            { topic: "Ovaio e Utero", question: "Una donna di 69 anni ha avuto sanguinamenti vaginali per un mese, l‚Äôesame pelvico non mostra anomalie di rilievo. A che procedura dovremmo ricorrere?", options: ["Biopsia endometriale", "Test di gravidanza", "Esame microbiologico", "Risonanza magnetica", "PAP test"], correctAnswer: 0, explanation: "Un sanguinamento in post-menopausa richiede sempre un'indagine per escludere un carcinoma dell'endometrio. La procedura diagnostica di scelta √® la biopsia endometriale, spesso eseguita tramite isteroscopia.", isFromFile: true },
            { topic: "Cardiocircolatorio", question: "Quale tratto coronarico √® verosimilmente occluso in un paziente con infarto dei due terzi anteriori del setto interventricolare e della faccia anteriore del ventricolo sinistro?", options: ["Ramo discendente anteriore a monte dell'emergenza del primo ramo diagonale", "Ramo discendente anteriore a valle dell'emergenza del primo ramo diagonale", "Tronco comune della coronaria destra", "Tronco comune della coronaria sinistra", "Ramo circonflesso"], correctAnswer: 0, explanation: "L'arteria discendente anteriore (IVA) irrora la parete anteriore del ventricolo sinistro e i 2/3 anteriori del setto. Un'occlusione a monte del primo ramo diagonale causa un infarto molto esteso in questo territorio.", isFromFile: true },
            { topic: "Polmone-Respiratorio", question: "Quale/i delle seguenti affermazioni sono esatte? I. L‚Äôenfisema centro-acinare √® il piu frequente II. L‚Äôenfisema pan-acinare √® associato alla deficienza di alpha1-antitripsina III. L‚Äôiperinsufflazione √® una forma di enfisema molto grave IV. Le aree enfisematose sono aumentate di consistenza V. L‚Äôenfisema parasettale colpisce le zone vicine ai setti fibrosi", options: ["Tutte", "Nessuna", "I, II, III", "I, II, V", "I, III, V"], correctAnswer: 3, explanation: "L'enfisema centro-acinare √® il pi√π comune (fumo), il pan-acinare √® legato al deficit di A1AT e il parasettale √® adiacente alla pleura/setti. L'iperinsufflazione non √® un tipo di enfisema e le aree enfisematose hanno consistenza diminuita.", isFromFile: true },
            { topic: "Osso", question: "Nel sarcoma di Ewing NON:", options: ["√à chemiosensibile", "√à radiosensibile", "Colpisce i giovani", "Produce osso e/o cartilagine", "Si accompagna a sintomi generali"], correctAnswer: 3, explanation: "Il sarcoma di Ewing √® un tumore a piccole cellule rotonde che non produce matrice ossea o cartilaginea, a differenza dell'osteosarcoma o del condrosarcoma. Questa caratteristica √® fondamentale per la diagnosi differenziale.", isFromFile: true },
            { topic: "Mammella", question: "La malattia di Paget della mammella √®:", options: ["Un carcinoma", "Una mastite", "Un adenoma", "Una disfunzione endocrina", "Un sarcoma"], correctAnswer: 0, explanation: "La malattia di Paget del capezzolo √® una manifestazione di un carcinoma duttale (solitamente in situ) sottostante, le cui cellule migrano lungo i dotti galattofori fino a infiltrare l'epidermide del capezzolo, causando una lesione eczematosa.", isFromFile: true },
            { topic: "Rene, Vie Urinarie e Vescica", question: "Il tumore della pelvi renale pi√π frequente √®:", options: ["Il carcinoma uroteliale", "L‚Äôadenocarcinoma", "Il carcinoma a cellule renali", "Il carcinoma epidermoide", "Il carcinoma a piccole cellule"], correctAnswer: 0, explanation: "La pelvi renale √® rivestita da urotelio, lo stesso epitelio della vescica. Pertanto, il tumore pi√π comune in questa sede √® il carcinoma uroteliale (o a cellule transizionali).", isFromFile: true },
            { topic: "Testicolo", question: "Un uomo di 24 anni accusa una tumefazione testicolare indolente, ecograficamente di aspetto disomogeneo. Qual/Quali √®/sono la/le diagnosi pi√π probabili?", options: ["Atrofia, Torsione, Idrocele", "Neoplasia testicolare", "Idrocele, Neoplasia, Orchite", "Tutte", "Solo Idrocele e Orchite"], correctAnswer: 1, explanation: "Una massa testicolare solida, indolente, in un giovane uomo deve essere considerata una neoplasia maligna fino a prova contraria. √à la presentazione clinica pi√π tipica dei tumori a cellule germinali.", isFromFile: true },
            { topic: "Prostata", question: "Quale delle seguenti informazioni circa l‚Äôiperplasia prostatica non √® esatta?", options: ["Origina dalla porzione periuretrale", "Istologicamente √® evidente iperplasia delle ghiandole e dello stroma", "Interessa il 90% dei maschi superiori ai 70 anni", "√à un fattore di rischio per lo sviluppo del carcinoma della prostata", "La componente ghiandolare presenta il doppio strato di cellule"], correctAnswer: 3, explanation: "L'iperplasia prostatica benigna (IPB) non √® considerata una lesione pre-cancerosa e non aumenta il rischio di sviluppare un adenocarcinoma prostatico, che tipicamente origina in una zona diversa (periferica).", isFromFile: true },
            { topic: "Ovaio e Utero", question: "Quale dei seguenti √® un tumore dell‚Äôovaio che non si presenta mai in forma cistica:", options: ["Cistoadenocarcinoma sieroso", "Tumore di Brenner", "Tumore di Krukenberg", "Teratoma maturo", "Tumore mucinoso"], correctAnswer: 2, explanation: "Il tumore di Krukenberg √® una metastasi ovarica, tipicamente da un adenocarcinoma gastrico a cellule con castone. √à caratteristicamente solido, a differenza di molti tumori ovarici primari che sono cistici.", isFromFile: true },
            { topic: "Metodologia", question: "Quale delle seguenti affermazioni √® esatta:", options: ["Una sostanza acida √® generalmente basofila e quindi ematossilinofila", "Una sostanza acida √® generalmente acidofila e quindi ematossilinofila", "Una sostanza acida √® generalmente basofila e quindi eosinofila", "Una sostanza acida √® generalmente acidofila e quindi eosinofila", "Una sostanza acida √® anfofila"], correctAnswer: 0, explanation: "Le sostanze acide (come gli acidi nucleici) hanno affinit√† per i coloranti basici. L'ematossilina √® un colorante basico, quindi le strutture acide sono basofile ed ematossilinofile.", isFromFile: true },
            { topic: "Danno Cellulare", question: "In caso di infezione tubercolare il quadro morfologico sar√† generalmente caratterizzato da:", options: ["Necrosi coagulativa", "Necrosi colliquativa", "Necrosi fibrinoide", "Necrosi caseosa", "Apoptosi"], correctAnswer: 3, explanation: "La necrosi caseosa √® la forma di necrosi patognomonica della tubercolosi. Macroscopicamente appare come materiale biancastro, friabile, simile a formaggio ('caseus' in latino).", isFromFile: true },
            { topic: "Adattamenti Cellulari", question: "Non √® una causa di atrofia:", options: ["Disuso", "Denervazione", "Aumentato stimolo endocrino", "Malnutrizione", "Diminuito apporto ematico"], correctAnswer: 2, explanation: "Un aumentato stimolo endocrino causa iperplasia o ipertrofia del tessuto bersaglio, non atrofia. L'atrofia √® una riduzione delle dimensioni cellulari dovuta a una ridotta richiesta funzionale o a condizioni avverse.", isFromFile: true },
            { topic: "Neoplasie", question: "Per anaplasia si intende?", options: ["Una forma di iperplasia patologica", "Un tipo di neoplasia a prognosi infausta", "Una forma particolare di metaplasia", "Una forma grave di displasia", "La mancanza di differenziazione delle cellule neoplastiche"], correctAnswer: 4, explanation: "L'anaplasia rappresenta la perdita completa della differenziazione cellulare ed √® un segno distintivo di malignit√†. Le cellule anaplastiche sono pleomorfe, con nuclei bizzarri e ipercromatici.", isFromFile: true },
            { topic: "Cardiocircolatorio", question: "La cardiomiopatia aritmogena del ventricolo destro: I geni pi√π frequentemente coinvolti codificano per:", options: ["Proteine del sarcomero", "Proteine mitocondriali", "Proteine del desmosoma", "Canali del potassio", "Recettori adrenergici"], correctAnswer: 2, explanation: "La cardiomiopatia aritmogena √® una 'malattia del desmosoma', causata da mutazioni in geni che codificano per proteine desmosomiali (placoglobina, desmoplachina, etc.), che porta a distacco dei miociti e sostituzione fibroadiposa.", isFromFile: true },
            { topic: "Polmone-Respiratorio", question: "Un uomo di 78 anni mostra dispnea ingravescente e una massa pleurica che incarcera il polmone. La biopsia mostra cellule fusate e cuboidi. Quale particella √® verosimilmente responsabile?", options: ["Silice", "Particelle di carbone", "Asbesto", "Fibre di cotone", "Berillio"], correctAnswer: 2, explanation: "La descrizione di una massa pleurica diffusa in un paziente anziano, con istologia bifasica (cellule epitelioidi/cuboidi e fusate/sarcomatoidi), √® classica per un mesotelioma maligno, fortemente associato all'esposizione ad asbesto.", isFromFile: true },
            { topic: "Osso", question: "L‚Äôosteosarcoma √®:", options: ["Un tumore benigno dell'osso", "Una malattia metabolica simil-neoplastica", "Un tumore maligno dell'osso", "Un tumore maligno del midollo", "Un tumore benigno del midollo"], correctAnswer: 2, explanation: "L'osteosarcoma √® il tumore maligno primitivo pi√π comune dell'osso (escludendo il mieloma), caratterizzato dalla produzione di matrice osteoide o osso immaturo da parte delle cellule neoplastiche.", isFromFile: true },
            { topic: "Mammella", question: "Una donna di 24 anni in fase pre-ovulare avverte un nodulo dolente, tondeggiante, a superficie liscia e mobile. Qual √® l‚Äôipotesi diagnostica pi√π probabile?", options: ["Fibroadenoma", "Carcinoma in situ", "Carcinoma infiltrante", "Tumore filloide", "Modificazioni fibroso-cistiche"], correctAnswer: 0, explanation: "Un nodulo mobile, ben definito, in una donna giovane √® altamente suggestivo di un fibroadenoma, il tumore benigno pi√π comune in questa fascia d'et√†. Le modificazioni fibrocistiche sono pi√π spesso mal definite e multiple.", isFromFile: true },
            // --- NUOVE DOMANDE AGGIUNTE ---
            { topic: "Cardiocircolatorio", question: "Un paziente muore per gli esiti di un infarto del miocardio e i familiari denunciano i sanitari perch√© ritengono che questi siano intervenuti tardivamente. Il patologo riceve dei preparati nei quali √® presente un infiltrato interstiziale di granulociti neutrofili e alla periferia del focolaio infartuale sono presenti macrofagi, fibroblasti e capillari neoformati. A quando fate risalire l'infarto?", options: ["12-24h prima", "24-36h prima", "3-5 giorni prima", "2-4 settimane prima", "7-10 giorni prima"], correctAnswer: 2, explanation: "La presenza simultanea di un infiltrato di granulociti neutrofili (picco a 1-3 giorni) e l'inizio della formazione di tessuto di granulazione (macrofagi, fibroblasti, capillari, che inizia dopo il 3¬∞ giorno) permette di datare l'infarto a circa 3-5 giorni prima del decesso.", isFromFile: true },
            { topic: "Cardiocircolatorio", question: "Quale tra i seguenti non √® un carattere morfologico della cardiomiopatia dilatativa:", options: ["Presenza di fibre muscolari striate", "Fibrosi focale dell‚Äôendocardio del ventricolo sinistro", "Ipertrofia eccentrica del miocardio", "Disarray delle miocellule", "Insufficienza relativa della valvola mitrale"], correctAnswer: 3, explanation: "Il 'disarray' (disorganizzazione) delle miocellule √® la caratteristica istologica distintiva della cardiomiopatia ipertrofica, non di quella dilatativa. La cardiomiopatia dilatativa √® caratterizzata da ipertrofia eccentrica, fibrosi e dilatazione ventricolare.", isFromFile: true },
            { topic: "Cardiocircolatorio", question: "Un cuore pesa 700 grammi ed ha forma globosa. Al taglio si osserva una dilatazione moderata delle cavit√† atriali, con dilatazione dell'anello delle valvole atrioventricolari. Il ventricolo sinistro √® notevolmente aumentato di volume, con spessore parietale conservato. Che diagnosi fai?", options: ["Cardiopatia ipertensiva", "Cardiomiopatia dilatativa", "Cardiopatia ischemica cronica", "Endocardite reumatica", "Cardiomiopatia ipertrofica"], correctAnswer: 1, explanation: "Il quadro macroscopico descritto (cuore globoso, aumentato di peso, con dilatazione ventricolare sinistra, fibrosi sostitutiva e trombo apicale) √® classico della cardiomiopatia dilatativa.", isFromFile: true },
            { topic: "Cardiocircolatorio", question: "Quale, tra le seguenti popolazioni cellulari, NON √® presente nella placca fibroateromasica?", options: ["Macrofagi schiumosi miogenici", "Macrofagi schiumosi monocitogenici", "Fibrocellule muscolari lisce", "Linfociti T", "Cellule adipose"], correctAnswer: 4, explanation: "La placca ateromasica √® composta da cellule muscolari lisce, macrofagi (anche schiumosi), linfociti T e matrice extracellulare. Le cellule adipose non sono un componente tipico della placca stessa.", isFromFile: true },
            { topic: "Cardiocircolatorio", question: "Una paziente di 45 anni √® affetta da numerosi anni da stenosi mitralica serrata. La valvola viene rimossa e sostituita. I lembi risultano ispessiti, duri, con commessure fuse e corde tendinee accorciate. Quale diagnosi fate?", options: ["Endocardite infettiva", "Endocardite da artrite reumatoide", "Calcificazione distrofica", "Endocardite trombotica", "Endocardite fibroblastica di verosimile origine reumatica"], correctAnswer: 4, explanation: "L'ispessimento e fusione dei lembi valvolari e delle corde tendinee, con calcificazioni, √® il quadro tipico degli esiti cronici di una endocardite reumatica, che porta a stenosi mitralica.", isFromFile: true },
            { topic: "Gastrointestinale", question: "L'istotipo pi√π frequente di carcinoma dell'esofago √®:", options: ["Carcinoma malpighiano", "Adenocarcinoma", "Carcinoma adenosquamoso", "Carcinoma su esofago di Barrett", "Angiosarcoma"], correctAnswer: 0, explanation: "A livello mondiale, il carcinoma a cellule squamose (o malpighiano) √® l'istotipo pi√π frequente di cancro esofageo, sebbene nei paesi occidentali l'incidenza dell'adenocarcinoma (spesso su esofago di Barrett) sia in forte aumento.", isFromFile: true },
            { topic: "Gastrointestinale", question: "La neoplasia epatica pi√π frequente √®:", options: ["Epatocarcinoma", "Colangiocarcinoma", "Epatoblastoma", "Angioma", "Carcinoma metastatico"], correctAnswer: 4, explanation: "Le metastasi da altri tumori (colon-retto, polmone, mammella, etc.) sono le neoplasie maligne pi√π comuni riscontrate nel fegato, superando di gran lunga i tumori epatici primitivi come l'epatocarcinoma.", isFromFile: true },
            { topic: "Gastrointestinale", question: "L'early gastric cancer‚Ä¶", options: ["√à limitato alla mucosa e alla sottomucosa", "Non supera la membrana basale", "Non metastatizza mai", "Colpisce gli adolescenti", "√à esclusivo dei giapponesi"], correctAnswer: 0, explanation: "Per definizione, l'Early Gastric Cancer √® un carcinoma che infiltra la mucosa e/o la sottomucosa, indipendentemente dallo stato dei linfonodi. Questa stadiazione precoce ha una prognosi eccellente dopo resezione.", isFromFile: true },
            { topic: "Gastrointestinale", question: "Non √® una caratteristica istologica del Morbo di Crohn:", options: ["Presenza di granulomi", "Interessamento a tutto spessore della parete", "Presenza frequente di displasia", "Presenza di infiltrato linfocitario", "Presenza di ulcerazioni aftoidi"], correctAnswer: 2, explanation: "La displasia pu√≤ insorgere come complicanza a lungo termine del Crohn, ma non √® una caratteristica istologica tipica della malattia attiva, che √® invece caratterizzata da infiammazione transmurale, ulcere aftoidi e granulomi non caseosi.", isFromFile: true },
            { topic: "Gastrointestinale", question: "Un soggetto con esofago di Barrett:", options: ["Non ha alcun problema clinico", "Rischia esclusivamente esofagiti ricorrenti", "Ha un aumentato rischio di sviluppare carcinoma malpighiano dell'esofago", "Ha un aumentato rischio di sviluppare adenocarcinoma dell'esofago", "√à protetto dal carcinoma esofageo"], correctAnswer: 3, explanation: "L'esofago di Barrett √® una metaplasia intestinale dell'epitelio esofageo distale ed √® il principale fattore di rischio per lo sviluppo dell'adenocarcinoma esofageo.", isFromFile: true },
            { topic: "Gastrointestinale", question: "Quale dei seguenti polipi non √® a rischio di trasformazione maligna?", options: ["Adenocarcinoma polipoide", "Polipo amartomatoso", "Adenoma tubulare", "Adenoma villoso", "Adenoma tubulo-villoso"], correctAnswer: 1, explanation: "I polipi amartomatosi (es. Peutz-Jeghers) sono malformazioni tissutali e hanno un rischio di trasformazione maligna intrinseca molto basso, a differenza degli adenomi (tubulari, villosi) che sono lesioni pre-neoplastiche.", isFromFile: true },
            { topic: "Polmone-Respiratorio", question: "Un uomo di 78 anni presenta dispnea ingravescente e una massa pleurica che incarcera il polmone. La biopsia mostra cellule fusate e cuboidi. Quale particella √® verosimilmente responsabile?", options: ["Silice", "Particelle di carbone", "Asbesto", "Fibre di cotone", "Berillio"], correctAnswer: 2, explanation: "La descrizione di una massa pleurica diffusa in un paziente anziano, con istologia bifasica (cellule epitelioidi/cuboidi e fusate/sarcomatoidi), √® classica per un mesotelioma maligno, fortemente associato all'esposizione ad asbesto.", isFromFile: true },
            { topic: "Osso", question: "Nell‚Äôosteoporosi si pu√≤ avere:", options: ["Ipercalcificazione cartilagine", "Normale e/o aumentata deposizione di matrice ossea, ma normale calcificazione", "Diminuita deposizione di matrice ossea, ma normale calcificazione", "Diminuita deposizione di matrice ossea e diminuita calcificazione", "Normale e/o aumentata deposizione di matrice ossea, ma diminuita calcificazione"], correctAnswer: 2, explanation: "L'osteoporosi √® caratterizzata da una perdita di massa ossea, cio√® una ridotta quantit√† di matrice ossea (osteopenia), ma la matrice residua √® normalmente mineralizzata (calcificata).", isFromFile: true },
            { topic: "Mammella", question: "Non √® un fattore di rischio per il carcinoma della mammella:", options: ["Nulliparit√†", "Menarca precoce", "Obesit√†", "Promiscuit√† sessuale", "Cicli anovulatori"], correctAnswer: 3, explanation: "I principali fattori di rischio per il carcinoma mammario sono legati all'esposizione agli estrogeni (menarca precoce, nulliparit√†, obesit√†). La promiscuit√† sessuale non √® un fattore di rischio diretto per il tumore al seno.", isFromFile: true },
            { topic: "Rene, Vie Urinarie e Vescica", question: "NON √® un fattore di rischio per il carcinoma della vescica:", options: ["Attivit√† lavorativa con i coloranti contenenti anilina", "Calcolosi vescicale", "Infestazione da Schistosoma", "Fumo di sigaretta", "Promiscuit√† sessuale"], correctAnswer: 4, explanation: "Il fumo di sigaretta, l'esposizione a amine aromatiche (coloranti), l'infiammazione cronica (calcoli, Schistosoma) sono noti fattori di rischio per il carcinoma uroteliale. La promiscuit√† sessuale non √® direttamente correlata.", isFromFile: true },
            { topic: "Testicolo", question: "Un uomo di 30 anni nota un progressivo ingrossamento dello scroto. Gli esami mostrano un marcato incremento di hCG e alfa-fetoproteina. Qual √® la neoplasia pi√π probabile?", options: ["Tumore a cellule di Leydig", "Seminoma spermatocitico", "Tumore germinale misto", "Linfoma a grandi cellule B diffuso", "Coriocarcinoma"], correctAnswer: 2, explanation: "L'aumento contemporaneo di Œ≤-hCG e AFP √® tipico di un tumore a cellule germinali non seminomatoso, in particolare di un tumore misto, che spesso contiene componenti di coriocarcinoma (produce hCG) e di tumore del sacco vitellino (produce AFP).", isFromFile: true },
            { topic: "Ovaio e Utero", question: "Una donna di 42 anni esegue un Pap test che risulta HSIL con positivit√† per HPV 18. Perch√© si procede con una conizzazione?", options: ["Presenza di cervicite cronica", "L‚Äôinfezione da HPV non pu√≤ essere trattata", "Rischio di carcinoma invasivo", "Fine dell‚Äôet√† riproduttiva", "Stato perimenopausale"], correctAnswer: 2, explanation: "Una lesione HSIL (CIN2/CIN3) ha un rischio significativo di progressione a carcinoma invasivo. La conizzazione √® una procedura sia diagnostica che terapeutica per rimuovere la lesione e prevenire l'invasione.", isFromFile: true },
            { topic: "Prostata", question: "Un uomo di 70 anni ha un PSA di 17 ng/ml, il doppio dell'anno prima. Quale sar√† il reperto pi√π probabile alla biopsia?", options: ["Prostatite acuta", "Iperplasia benigna", "Neoplasia intraepiteliale prostatica di alto grado", "Prostatite cronica non batterica", "Adenocarcinoma"], correctAnswer: 4, explanation: "Un valore di PSA elevato e in rapido aumento in un uomo anziano √® altamente sospetto per un adenocarcinoma prostatico, che richiede una conferma bioptica.", isFromFile: true },
            { topic: "Cardiocircolatorio", question: "Quale delle seguenti condizioni pu√≤ predisporre ad un‚Äôendocardite infettiva?", options: ["Tutte le condizioni elencate", "Un prolasso della mitrale", "Un ostio aortico bicuspide", "Un impianto di protesi valvolare", "Un'endocardite reumatica"], correctAnswer: 0, explanation: "Tutte le condizioni elencate (prolasso mitrale, valvola bicuspide, protesi valvolari, esiti di endocardite reumatica) creano turbolenze del flusso sanguigno e/o superfici anomale che favoriscono l'adesione batterica e lo sviluppo di un'endocardite infettiva.", isFromFile: true },
            { topic: "Cardiocircolatorio", question: "Abbina placca stabile (I) e instabile (II) con le caratteristiche: A-stenosi eccentrica, B-stenosi concentrica, C-ampio ateroma/cappuccio sottile, D-placca fibrocalcifica, E-infiltrato infiammatorio.", options: ["I BD, II ACE", "I BDE, II AC", "I BC, II ADE", "I ADE, II BC", "I AD, II BCE"], correctAnswer: 0, explanation: "La placca stabile (I) √® caratterizzata da stenosi concentrica (B) e fibrosi/calcificazione (D). La placca instabile (II), pi√π a rischio di rottura, presenta tipicamente stenosi eccentrica (A), un ampio core lipidico con cappuccio sottile (C) e un marcato infiltrato infiammatorio (E).", isFromFile: true }
        ];

        // --- GESTIONE DELLO STATO DEL QUIZ ---
        let currentQuestionIndex = 0;
        let selectedQuestions = [];
        let userAnswers = {};
        const TOTAL_QUESTIONS = 45;
        let currentUser = null;

        // --- RIFERIMENTI AGLI ELEMENTI DEL DOM ---
        let startQuizBtn, finishQuizBtn, restartBtn, setupSection, quizSection, reportSection, 
            progressContainer, progressBar, progressText, topicSelection, topicsList, selectAllTopics,
            loginSection, appContainer, loginForm, loginError;

        // --- EVENT LISTENER PRINCIPALE ---
        document.addEventListener('DOMContentLoaded', initializeApp);

        // --- FUNZIONI DI AUTENTICAZIONE E TEMA ---
        const users = {
            "admin": "admin",
            "gigliola.1974860": "BeatriceFidanzataBellissima2025!"
        };

        function handleLogin(event) {
            event.preventDefault();
            const username = loginForm.username.value;
            const password = loginForm.password.value;

            if (users[username] && users[username] === password) {
                currentUser = username;
                sessionStorage.setItem('currentUser', currentUser);
                loginSection.classList.add('hidden');
                appContainer.classList.remove('hidden');
                loadTheme();
                initializeAppLogic();
            } else {
                loginError.classList.remove('hidden');
            }
        }
        
        function checkSession() {
            const user = sessionStorage.getItem('currentUser');
            if (user) {
                currentUser = user;
                loginSection.classList.add('hidden');
                appContainer.classList.remove('hidden');
                loadTheme();
                initializeAppLogic();
            }
        }

        function applyTheme(theme) {
            if (theme === 'light') {
                document.documentElement.classList.add('light');
            } else {
                document.documentElement.classList.remove('light');
            }
        }

        function setTheme(theme) {
            if (theme === 'system') {
                localStorage.removeItem(`theme_${currentUser}`);
                const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                applyTheme(systemPrefersDark ? 'dark' : 'light');
            } else {
                localStorage.setItem(`theme_${currentUser}`, theme);
                applyTheme(theme);
            }
        }

        function loadTheme() {
            let savedTheme = localStorage.getItem(`theme_${currentUser}`);
            if (savedTheme) {
                applyTheme(savedTheme);
            } else {
                const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                applyTheme(systemPrefersDark ? 'dark' : 'light');
            }
        }

        // --- FUNZIONI PRINCIPALI DELL'APP ---

        function initializeApp() {
            // Riferimenti agli elementi di login e contenitore
            loginSection = document.getElementById('login-section');
            appContainer = document.getElementById('app-container');
            loginForm = document.getElementById('login-form');
            loginError = document.getElementById('login-error');
            
            loginForm.addEventListener('submit', handleLogin);
            
            checkSession(); // Controlla se c'√® gi√† una sessione attiva
        }

        function initializeAppLogic() {
            // Inizializzazione delle variabili degli elementi del DOM del quiz
            startQuizBtn = document.getElementById('start-quiz-btn');
            finishQuizBtn = document.getElementById('finish-quiz-btn');
            restartBtn = document.getElementById('restart-btn');
            setupSection = document.getElementById('setup-section');
            quizSection = document.getElementById('quiz-section');
            reportSection = document.getElementById('report-section');
            progressContainer = document.getElementById('progress-container');
            progressBar = document.getElementById('progress-bar');
            progressText = document.getElementById('progress-text');
            topicSelection = document.getElementById('topic-selection');
            topicsList = document.getElementById('topics-list');
            selectAllTopics = document.getElementById('select-all-topics');
            
            // Listeners del quiz
            startQuizBtn.addEventListener('click', startQuiz);
            finishQuizBtn.addEventListener('click', finishQuiz);
            restartBtn.addEventListener('click', () => {
                // Ricarica solo la parte dell'app, non fa il logout
                quizSection.classList.add('hidden');
                reportSection.classList.add('hidden');
                setupSection.classList.remove('hidden');
            });
            selectAllTopics.addEventListener('change', toggleAllTopics);
            document.getElementById('prev-btn').addEventListener('click', showPreviousQuestion);
            document.getElementById('next-btn').addEventListener('click', showNextQuestion);

            // Listeners del tema
            document.getElementById('theme-light').addEventListener('click', () => setTheme('light'));
            document.getElementById('theme-dark').addEventListener('click', () => setTheme('dark'));
            document.getElementById('theme-system').addEventListener('click', () => setTheme('system'));
            
            // Logica di avvio dell'app
            allTopics = [...new Set(questionBank.map(q => q.topic))].sort();
            updateProgressBar(allTopics.length);
            displayTopics();
            startQuizBtn.disabled = false;
        }

        function updateProgressBar(topicsIdentified) {
            progressText.textContent = `Sono stati identificati ${topicsIdentified} argomenti dai tuoi file.`;
            progressContainer.classList.remove('hidden');
        }

        function displayTopics() {
            topicsList.innerHTML = '';
            allTopics.forEach((topic, index) => {
                const topicId = `topic-${index}`;
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = topicId;
                checkbox.value = topic;
                checkbox.className = 'topic-checkbox hidden';
                checkbox.checked = true;

                const label = document.createElement('label');
                label.htmlFor = topicId;
                label.textContent = topic;
                label.className = 'topic-label px-3 py-1.5 border rounded-full text-sm cursor-pointer transition-colors duration-200';

                topicsList.appendChild(checkbox);
                topicsList.appendChild(label);
            });
            topicSelection.classList.remove('hidden');
            selectAllTopics.checked = true;
        }
        
        function toggleAllTopics() {
            const checkboxes = document.querySelectorAll('.topic-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAllTopics.checked;
            });
        }

        function startQuiz() {
            const selectedTopics = Array.from(document.querySelectorAll('.topic-checkbox:checked')).map(cb => cb.value);
            if (selectedTopics.length === 0) {
                const errorMsg = document.createElement('p');
                errorMsg.textContent = 'Per favore, seleziona almeno un argomento.';
                errorMsg.className = 'text-red-400 text-center mt-4';
                startQuizBtn.insertAdjacentElement('afterend', errorMsg);
                setTimeout(() => errorMsg.remove(), 3000);
                return;
            }

            // --- LOGICA PER EVITARE RIPETIZIONI (SPECIFICA PER UTENTE) ---
            const historyKey = `recentlyUsedQuestions_${currentUser}`;
            let recentlyUsedQuestions = JSON.parse(localStorage.getItem(historyKey)) || [];
            
            let availableQuestions = questionBank.filter(q => !recentlyUsedQuestions.includes(q.question));

            if (availableQuestions.length < TOTAL_QUESTIONS) {
                console.log("Non ci sono abbastanza domande nuove per questo utente, resetto la cronologia.");
                recentlyUsedQuestions = [];
                localStorage.removeItem(historyKey);
                availableQuestions = questionBank;
            }

            let filteredByTopic = availableQuestions.filter(q => selectedTopics.includes(q.topic));
             if (filteredByTopic.length < TOTAL_QUESTIONS) {
                const otherQuestions = availableQuestions.filter(q => !selectedTopics.includes(q.topic));
                filteredByTopic.push(...otherQuestions);
            }
            
            selectedQuestions = filteredByTopic.sort(() => 0.5 - Math.random()).slice(0, TOTAL_QUESTIONS);

            const newQuestionsForHistory = selectedQuestions.map(q => q.question);
            recentlyUsedQuestions.push(...newQuestionsForHistory);

            const maxHistorySize = TOTAL_QUESTIONS * 2;
            if (recentlyUsedQuestions.length > maxHistorySize) {
                recentlyUsedQuestions = recentlyUsedQuestions.slice(recentlyUsedQuestions.length - maxHistorySize);
            }
            localStorage.setItem(historyKey, JSON.stringify(recentlyUsedQuestions));
            // --- FINE LOGICA RIPETIZIONI ---

            currentQuestionIndex = 0;
            userAnswers = {};
            
            setupSection.classList.add('hidden');
            quizSection.classList.remove('hidden');
            displayCurrentQuestion();
        }

        function displayCurrentQuestion() {
            const quizContent = document.getElementById('quiz-content');
            const q = selectedQuestions[currentQuestionIndex];
            quizContent.innerHTML = '';

            const questionBlock = document.createElement('div');
            const questionText = document.createElement('p');
            questionText.className = 'text-xl font-medium mb-6';
            const prefix = q.isFromFile ? '[D] ' : '';
            questionText.textContent = `${prefix}${q.question}`;
            questionBlock.appendChild(questionText);

            const optionsList = document.createElement('div');
            optionsList.className = 'space-y-3';
            q.options.forEach((option, optionIndex) => {
                const optionId = `q${currentQuestionIndex}o${optionIndex}`;
                const optionContainer = document.createElement('div');
                
                const radio = document.createElement('input');
                radio.type = 'radio';
                radio.id = optionId;
                radio.name = `question-${currentQuestionIndex}`;
                radio.value = optionIndex;
                radio.className = 'option-radio hidden';
                if (userAnswers[currentQuestionIndex] === optionIndex) {
                    radio.checked = true;
                }
                radio.addEventListener('change', () => {
                    userAnswers[currentQuestionIndex] = parseInt(radio.value);
                });

                const label = document.createElement('label');
                label.htmlFor = optionId;
                label.textContent = option;
                label.className = 'block p-4 rounded-lg border-2 card-border input-bg hover:bg-gray-600 cursor-pointer transition-colors';
                
                optionContainer.appendChild(radio);
                optionContainer.appendChild(label);
                optionsList.appendChild(optionContainer);
            });
            questionBlock.appendChild(optionsList);
            quizContent.appendChild(questionBlock);

            updateQuizUI();
        }

        function updateQuizUI() {
            document.getElementById('question-counter').textContent = `Domanda ${currentQuestionIndex + 1} di ${TOTAL_QUESTIONS}`;
            const progress = ((currentQuestionIndex + 1) / TOTAL_QUESTIONS) * 100;
            document.getElementById('quiz-progress-bar').style.width = `${progress}%`;

            document.getElementById('prev-btn').disabled = currentQuestionIndex === 0;
            document.getElementById('prev-btn').classList.toggle('opacity-50', currentQuestionIndex === 0);
            
            if (currentQuestionIndex === TOTAL_QUESTIONS - 1) {
                document.getElementById('next-btn').textContent = 'Vedi Risultati';
            } else {
                document.getElementById('next-btn').textContent = 'Successivo';
            }
        }

        function showPreviousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                displayCurrentQuestion();
            }
        }

        function showNextQuestion() {
            if (currentQuestionIndex < TOTAL_QUESTIONS - 1) {
                currentQuestionIndex++;
                displayCurrentQuestion();
            } else {
                finishQuiz();
            }
        }

        function finishQuiz() {
            let score = 0;
            for (let i = 0; i < selectedQuestions.length; i++) {
                if (userAnswers[i] === selectedQuestions[i].correctAnswer) {
                    score++;
                }
            }
            
            const normalizedScore = Math.round((score / TOTAL_QUESTIONS) * 33);
            document.getElementById('final-score').textContent = `${normalizedScore}/33`;
            
            displayReport();
            quizSection.classList.add('hidden');
            reportSection.classList.remove('hidden');
        }

        function displayReport() {
            const reportContent = document.getElementById('report-content');
            reportContent.innerHTML = '';
            selectedQuestions.forEach((q, index) => {
                const userAnswerIndex = userAnswers[index];
                const isCorrect = userAnswerIndex === q.correctAnswer;
                const wasAnswered = userAnswerIndex !== undefined;

                let statusClass = 'unanswered';
                let statusText = 'Non Risposto';

                if (wasAnswered) {
                    if (isCorrect) {
                        statusClass = 'correct';
                        statusText = 'Corretto';
                    } else {
                        statusClass = 'incorrect';
                        statusText = 'Sbagliato';
                    }
                }

                const card = document.createElement('div');
                card.className = `report-card border rounded-lg overflow-hidden ${statusClass}`;

                const header = document.createElement('div');
                header.className = `report-header p-3 cursor-pointer flex justify-between items-center`;
                const prefix = q.isFromFile ? '[D] ' : '';
                header.innerHTML = `
                    <p class="font-semibold">${index + 1}. ${prefix}${q.question}</p>
                    <div class="flex items-center flex-shrink-0 ml-4">
                        <span class="status-text text-sm font-bold mr-2">${statusText}</span>
                        <svg class="w-5 h-5 transition-transform subheader" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </div>
                `;

                const body = document.createElement('div');
                body.className = 'p-4 border-t card-border hidden space-y-3';
                
                let bodyHTML = `<p><strong>Risposta corretta:</strong> <span class="text-green-400 font-medium">${q.options[q.correctAnswer]}</span></p>`;
                if (!isCorrect && wasAnswered) {
                    bodyHTML += `<p><strong>La tua risposta:</strong> <span class="text-red-400 font-medium">${q.options[userAnswerIndex]}</span></p>`;
                }
                bodyHTML += `<div class="mt-2 pt-3 border-t card-border"><p class="text-sm subheader"><strong>Spiegazione:</strong> ${q.explanation}</p></div>`;
                body.innerHTML = bodyHTML;

                header.addEventListener('click', () => {
                    body.classList.toggle('hidden');
                    header.querySelector('svg').classList.toggle('rotate-180');
                });

                card.appendChild(header);
                card.appendChild(body);
                reportContent.appendChild(card);
            });
        }
    </script>

</body>
</html>
